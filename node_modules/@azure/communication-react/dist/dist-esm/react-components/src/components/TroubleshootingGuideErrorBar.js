// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
import React, { useEffect, useState } from 'react';
import { Link, MessageBar, MessageBarButton, Stack, useTheme } from '@fluentui/react';
import { useLocale } from '../localization';
import { dismissButtonStyle, linkStyle, messageBarStyle } from './styles/TroubleshootingGuideErrorBar.styles';
import { dismissError, dropDismissalsForInactiveErrors, errorsToShow, messageBarIconProps, messageBarType } from './utils';
/**
 * @internal
 * A component to show device Permission/network connection related errors, contains link that leads to further trouble shooting guide
 */
export const _TroubleshootingGuideErrorBar = (props) => {
    var _a;
    const theme = useTheme(); // error bar strings
    const localeStrings = useLocale().strings.errorBar;
    const strings = (_a = props.strings) !== null && _a !== void 0 ? _a : localeStrings;
    const [dismissedErrors, setDismissedErrors] = useState([]);
    const { onPermissionsTroubleshootingClick, onNetworkingTroubleshootingClick, permissionsState = {
        camera: 'denied',
        microphone: 'denied'
    }, troubleshootingGuideStrings } = props; // dropDismissalsForInactiveErrors only returns a new object if `dismissedErrors` actually changes.
    // Without this behaviour, this `useEffect` block would cause a render loop.
    useEffect(() => setDismissedErrors(dropDismissalsForInactiveErrors(props.activeErrorMessages, dismissedErrors)), [props.activeErrorMessages, dismissedErrors]);
    const toShow = errorsToShow(props.activeErrorMessages, dismissedErrors);
    return React.createElement(Stack, { "data-ui-id": "error-bar-stack" }, toShow.map(error => React.createElement(MessageBar, Object.assign({}, props, { styles: messageBarStyle(theme, messageBarType(error.type)), key: error.type, messageBarType: messageBarType(error.type), messageBarIconProps: messageBarIconProps(error.type), actions: React.createElement(MessageBarButton, { text: troubleshootingGuideStrings.dismissButtonText, styles: dismissButtonStyle(theme), onClick: () => {
                setDismissedErrors(dismissError(dismissedErrors, error));
            }, ariaLabel: strings.dismissButtonAriaLabel }), isMultiline: false }), onPermissionsTroubleshootingClick || onNetworkingTroubleshootingClick ? React.createElement("div", null,
        strings[error.type],
        React.createElement(Link, { styles: linkStyle(theme), onClick: () => {
                if (onPermissionsTroubleshootingClick) {
                    onPermissionsTroubleshootingClick(permissionsState);
                }
                else if (onNetworkingTroubleshootingClick) {
                    onNetworkingTroubleshootingClick();
                }
            }, underline: true },
            React.createElement("span", null, troubleshootingGuideStrings.linkText))) : React.createElement("div", null,
        strings[error.type],
        " "))));
};
//# sourceMappingURL=TroubleshootingGuideErrorBar.js.map